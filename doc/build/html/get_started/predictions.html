
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Predictions &#8212; Gloria 0.1.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=c7fef49e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'get_started/predictions';</script>
    <link rel="icon" href="../_static/gloria_favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model Selection" href="model_selection.html" />
    <link rel="prev" title="Events" href="events.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1.2" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/glorialogo.png" class="logo__image only-light" alt="Gloria 0.1.1 documentation - Home"/>
    <img src="../_static/glorialogo_white.png" class="logo__image only-dark pst-js-only" alt="Gloria 0.1.1 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../release_notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/e-dyn/gloria" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Getting Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../release_notes/index.html">
    Release notes
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/e-dyn/gloria" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="seasonalities.html">Seasonalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="modeling_trends.html">Modeling Trends</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Predictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_selection.html">Model Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="decomposition_types.html">Decomposition Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="saturation.html">Saturation</a></li>
<li class="toctree-l1"><a class="reference internal" href="calendric_data.html">Calendric Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_regressors.html">External Regressors</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Getting Started</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Predictions</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="predictions">
<span id="ref-predictions"></span><h1>Predictions<a class="headerlink" href="#predictions" title="Link to this heading">#</a></h1>
<p>In the previous tutorials, we frequently used the <em>model → fit → predict</em> workflow. The output of <a class="reference internal" href="../api/api/gloria.Gloria.predict.html#gloria.Gloria.predict" title="gloria.Gloria.predict"><code class="xref py py-meth docutils literal notranslate"><span class="pre">predict()</span></code></a> was usually passed directly into the <a class="reference internal" href="../api/api/gloria.Gloria.plot.html#gloria.Gloria.plot" title="gloria.Gloria.plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot()</span></code></a> method without inspecting it further. In this tutorial, we will take a closer look at the predictions themselves, focusing on a key feature that sets Gloria apart from Prophet: the distinction between confidence intervals around the predicted expectation and intervals describing the variability of observed data.</p>
<section id="output-data-frame">
<h2>Output Data Frame<a class="headerlink" href="#output-data-frame" title="Link to this heading">#</a></h2>
<p>Let’s start with a simple example from the <a class="reference internal" href="basic_usage.html#ref-basic-usage"><span class="std std-ref">Basic Usage</span></a> tutorial:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>             <span class="c1"># For loading and processing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gloria</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gloria</span>

<span class="c1"># Load the data</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/e-dyn/gloria/main/scripts/data/real/AEP_hourly.csv&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c1"># Save the column names for later usage</span>
<span class="n">timestamp_name</span> <span class="o">=</span> <span class="s2">&quot;Datetime&quot;</span>
<span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;AEP_MW&quot;</span>

<span class="c1"># Convert to datetime</span>
<span class="n">data</span><span class="p">[</span><span class="n">timestamp_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">timestamp_name</span><span class="p">])</span>

<span class="c1"># Restrict data to last 14 days</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;Datetime&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">336</span><span class="p">)</span>

<span class="c1"># Set up the model</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Gloria</span><span class="p">(</span>
    <span class="n">model</span> <span class="o">=</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span>
    <span class="n">metric_name</span> <span class="o">=</span> <span class="n">metric_name</span><span class="p">,</span>
    <span class="n">timestamp_name</span> <span class="o">=</span> <span class="n">timestamp_name</span><span class="p">,</span>
    <span class="n">sampling_period</span> <span class="o">=</span> <span class="s2">&quot;1 h&quot;</span><span class="p">,</span>
    <span class="n">n_changepoints</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># Add observed seasonalities</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_seasonality</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;daily&quot;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s2">&quot;24 h&quot;</span><span class="p">,</span> <span class="n">fourier_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_seasonality</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;weekly&quot;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s2">&quot;7 d&quot;</span><span class="p">,</span> <span class="n">fourier_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Fit the model to the data</span>
<span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Predict</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">96</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">include_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>With the plot shown here:</p>
<a class="reference internal image-reference" href="../_images/01_basic_usage_fig02.png"><img alt="Plot of the Gloria fit and forecast of the power consumption data set." class="align-center" src="../_images/01_basic_usage_fig02.png" style="width: 700px;" />
</a>
<p>The plot elements forecast, trend, and confidence intervals are all stored in the <code class="docutils literal notranslate"><span class="pre">prediction</span></code> data frame. This object is returned by <a class="reference internal" href="../api/api/gloria.Gloria.predict.html#gloria.Gloria.predict" title="gloria.Gloria.predict"><code class="xref py py-meth docutils literal notranslate"><span class="pre">predict()</span></code></a> and consumed by <a class="reference internal" href="../api/api/gloria.Gloria.plot.html#gloria.Gloria.plot" title="gloria.Gloria.plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot()</span></code></a>. We can explore its contents by printing the column names:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">prediction</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Datetime</span></code>: Timestamps at which the prediction was evaluated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yhat</span></code>: The overall prediction, shown as orange solid line.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">yhat_upper</span></code>/<code class="docutils literal notranslate"><span class="pre">yhat_lower</span></code>: Upper and lower bounds on the prediction at a confidence level defined by <code class="docutils literal notranslate"><span class="pre">m.interval_width</span></code> (default 80%). These bounds are <strong>not</strong> shown in the plot.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">observed_lower</span></code>/<code class="docutils literal notranslate"><span class="pre">observed_upper</span></code>: Bounds on the variability of the observed data, derived from the underlying distribution model at a quantile level specified by <code class="docutils literal notranslate"><span class="pre">m.interval_width</span></code>. These bounds are displayed by the grey area.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trend</span></code>: Trend component of the model, shown as black solid line.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trend_upper</span></code>/<code class="docutils literal notranslate"><span class="pre">trend_lower</span></code>: Bounds corresponding to the trend contribution within <code class="docutils literal notranslate"><span class="pre">observed_lower</span></code>/<code class="docutils literal notranslate"><span class="pre">observed_upper</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*_linked_*</span></code>: The respective quantities on the scale of the underlying generalized linear model, transformed by the <em>link-function</em>. See <a class="reference internal" href="decomposition_types.html#ref-decomposition-types"><span class="std std-ref">Decomposition Types</span></a> tutorial for details.</p></li>
</ul>
<p>Some of these columns need further explanation, which is given in the following.</p>
</section>
<section id="confidence-bands-vs-data-variability">
<h2>Confidence Bands vs Data Variability<a class="headerlink" href="#confidence-bands-vs-data-variability" title="Link to this heading">#</a></h2>
<p>By default, Gloria’s <a class="reference internal" href="../api/api/gloria.Gloria.fit.html#gloria.Gloria.fit" title="gloria.Gloria.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fit()</span></code></a> method yields a point estimate of all model parameters by performing a maximum a posteriori estimation. As a consequence, the prediction <code class="docutils literal notranslate"><span class="pre">yhat</span></code> is also just a point estimate and does not by itself include uncertainty. To add a confidence band around <code class="docutils literal notranslate"><span class="pre">yhat</span></code> you can use <a class="reference external" href="https://mc-stan.org/docs/cmdstan-guide/laplace_sample_config.html">Laplace sampling</a>. This method draws samples from a normal approximation centered at the optimized mode. To trigger Laplace sampling, set the <code class="docutils literal notranslate"><span class="pre">use_laplace=True</span></code> flag while calling <a class="reference internal" href="../api/api/gloria.Gloria.fit.html#gloria.Gloria.fit" title="gloria.Gloria.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fit()</span></code></a>. When running the fit, Gloria’s logger will inform you about the steps being taken:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">09:49:57 - gloria - INFO - Starting optimization.</span>
<span class="go">09:49:57 - gloria - INFO - Starting Laplace sampling.</span>
<span class="go">09:49:58 - gloria - INFO - Evaluate model at all samples for yhat upper and lower bounds.</span>
</pre></div>
</div>
<p>Here, Gloria first runs the optimization, then applies Laplace sampling, and finally calculates the upper and lower bounds for <code class="docutils literal notranslate"><span class="pre">yhat</span></code>, saved in the <code class="docutils literal notranslate"><span class="pre">yhat_upper</span></code> and <code class="docutils literal notranslate"><span class="pre">yhat_lower</span></code> columns of the prediction output. These columns also exist when <code class="docutils literal notranslate"><span class="pre">use_laplace=False</span></code> is set. In that case, <code class="docutils literal notranslate"><span class="pre">yhat</span></code>, <code class="docutils literal notranslate"><span class="pre">yhat_upper</span></code>, and <code class="docutils literal notranslate"><span class="pre">yhat_lower</span></code> are identical.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The quality of Laplace sampling depends on how well the normal approximation agrees with the true a posteriori distribution.</p>
</div>
<p>In contrast, data variability is always computed, as it only requires the point estimate from the optimization step. Specifically, the optimized fit parameters are passed to the model’s percent point function (see <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>) along with the upper and lower confidence levels corresponding to the requested interval width. The results are stored in the <code class="docutils literal notranslate"><span class="pre">observed_upper</span></code> and <code class="docutils literal notranslate"><span class="pre">observed_lower</span></code> columns. Typically, the variability interval is much wider than the confidence band of <code class="docutils literal notranslate"><span class="pre">yhat</span></code>, which is illustrated in the following plot of the first 100 data points: <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<a class="reference internal image-reference" href="../_images/predictions_ci_vs_variability.png"><img alt="Comparison of confidence band with data variability" class="align-center" src="../_images/predictions_ci_vs_variability.png" style="width: 700px;" />
</a>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Keep in mind: in Prophet <code class="docutils literal notranslate"><span class="pre">yhat_upper</span></code> and <code class="docutils literal notranslate"><span class="pre">yhat_lower</span></code> represent data variability and therefore correspond to Gloria’s <code class="docutils literal notranslate"><span class="pre">observed_upper</span></code> and <code class="docutils literal notranslate"><span class="pre">observed_lower</span></code>.</p>
</div>
</section>
<section id="trend-predictions">
<h2>Trend Predictions<a class="headerlink" href="#trend-predictions" title="Link to this heading">#</a></h2>
<p>While Gloria assumes stationary seasonality and event patterns, the trend component is less predictable. Neither the location nor the size of changepoint rate changes can be known in advance. What we can specify, however, are <em>changepoint density</em> and <em>mean rate change</em>, as they have been learned during training. Gloria uses these parameters to predict the trend and its uncertainty in the same fashion as <a class="reference external" href="https://facebook.github.io/prophet/docs/uncertainty_intervals.html#uncertainty-in-the-trend">Prophet</a>. The following figure shows the outcome of our example, when <code class="docutils literal notranslate"><span class="pre">n_changepoints=8</span></code> is set:</p>
<a class="reference internal image-reference" href="../_images/prediction_trend_uncertainty.png"><img alt="Plot of the Gloria fit and forecast of the power consumption data set." class="align-center" src="../_images/prediction_trend_uncertainty.png" style="width: 700px;" />
</a>
<p>From the result we observe the following:</p>
<ol class="arabic simple">
<li><p>From the 8 changepoints in total, only 3 result in meaningful rate changes, due to the sparse prior on rate changes.</p></li>
<li><p>It is not possible to assume specific changepoints or rate changes in the forecast period. Therefore, the trend forecast is simply an extrapolation of the latest trend in the training period.</p></li>
<li><p>The variability intervals widen as the forecast extends further beyond the training data. This is the result of an additional <em>trend uncertainty</em> estimation step, which simulates possible future trends based on the known changepoint density and mean rate change. Their distribution contributes to the overall variability. The number of these simulations can be controlled by the Gloria input parameter <code class="docutils literal notranslate"><span class="pre">trend_samples</span></code> (1000 by default).</p></li>
</ol>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Gloria uses scipy’s percent point function <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.rv_continuous.ppf.html#scipy.stats.rv_continuous.ppf" title="(in SciPy v1.16.1)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">scipy.stats.rv_continuous.ppf()</span></code></a> for respective distribution, e.g. <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.gamma.html#scipy.stats.gamma" title="(in SciPy v1.16.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.stats.gamma</span></code></a>.</p>
</aside>
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Note that Gloria’s plot method has been modified for the sake of this figure. By default, the confidence band defined by <code class="docutils literal notranslate"><span class="pre">yhat_upper</span></code> and <code class="docutils literal notranslate"><span class="pre">yhat_lower</span></code> cannot be plotted.</p>
</aside>
</aside>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="events.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Events</p>
      </div>
    </a>
    <a class="right-next"
       href="model_selection.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model Selection</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-data-frame">Output Data Frame</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-bands-vs-data-variability">Confidence Bands vs Data Variability</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#trend-predictions">Trend Predictions</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>